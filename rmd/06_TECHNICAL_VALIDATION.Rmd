# Technical validation

_The Technical Validation section should present any experiments or analyses that are needed to support the technical quality of the dataset. This section may be supported by figures and tables, as needed. This is a required section; authors must provide information to justify the reliability of their data.w 

Possible content **may include**:

-	experiments that support or validate the data-collection procedure(s) (e.g. negative controls, or an analysis of standards to confirm measurement linearity)
-	statistical analyses of experimental error and variation
-	general discussions of any procedures used to ensure reliable and unbiased data production, such as blinding and randomization, sample tracking systems, etc. 
-	any other information needed for assessment of technical rigour by the referees

Generally, this **should not include**:
-	follow-up experiments aimed at testing or supporting an interpretation of the data
-	statistical hypothesis testing 
-	exploratory computational analyses_

To affirm the credibility of the Nominal Catch GTA, it was compared with FishstatJ's data. 
FishstatJ is a desktop application provided by the Food and Agriculture Organization (FAO) of the United Nations. It enables users to access, visualize, and analyze global fisheries and aquaculture statistical time series. The data used for the comparison is found [here] (https://www.fao.org/fishery/static/Data/Capture_2023.1.1.zip)

The ensuing assessment drew several pivotal observations:

## 1. Dataset Harmonization

- The Nominal Catch GTA was harmonized with Fishstat using mapping datasets available [here](https://github.com/manuchassot/GTA_NC_DataPaper/blob/main/inputs/mappings/Mapping_from_fsj_to_nc.csv). The dataset encompassed country-level aggregation, merging entities such as "Martinique" and "Saint Pierre et Miquelon" under "France (EU)".

## Overall comparison

```{r}
table_comp <- read.csv(here("rmd/Comparison_NC_FS/figures/Diffstratas/Comparison.of.number.of.stratas.between.the.two.datasets.csv"))

qflextable2(table_comp, columns_to_color  = c("Difference"))
```

```{r temporal_analysis}
min_year_not_commun <- lubridate::year(min(NC$year))
max_year_not_commun <- lubridate::year(min(CAPTURE_TO_COMPARE$year))

```

- During the period from `r min_year_not_commun` to `r max_year_not_commun`, only the Nominal Catch GTA recorded declarations.

- FishstatJ provides 274 species that Nominal Catch does not record and Nominal catch provides 1 species which is not found in FishstatJ.
  
- Fishstats included two additional geographic areas not present in the NC data. (i.e America, South - Inland waters and Mediterranean and Black Sea)

- Nominal Catch provides 29 gear_labels, Fishstats provide none. 

- Nominal catch provides mapping for species contributing to the creation of 9 species group versus 2 for FishstatJ. However the mapping of Nominal catch can be and is used on FishstatJ for the remaining analysis.

For the remaining of the analyis, both datasets are filtered on the commun year, commun species and commun ocean basin. 


## Comparison on reduced datasets

```{r}
table_comp <- read.csv(here("rmd/Comparison_NC_FS/figures_filtered/Diffstratas/Comparison.of.number.of.stratas.between.the.two.datasets.csv"))

qflextable2(table_comp, columns_to_color  = c("Difference"))
```

### 1. Temporal Analysis

```{r}

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Temporal/Evolutions.of.values.for.the.dimension.year.for.Fishstat.and.Nominal.catch.dataset..png"))

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Temporaldiff/Differences.in.percent.of.value.for.temporal.dimension....year.between.Fishstat.and.Nominal.catch.dataset..png"))

```

Fishstat recorded higher values for most of the years declared (from 1950 to 1965 and from 1972-2021)


## 2. Species Distribution

Capture of the main species follow the same trend for both datasets, however the relative repartition of the major species are significantly different.

```{r fig.cap = 'Relatives percentage of catches by species (1) and species group (2) for Fishstat and Nominal catches dataset', eval=FALSE}

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Piechartsdimensions/Distribution.in.value.for.the.dimension...species.group.gta.png"))

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Piechartsdimensions/Distribution.in.value.for.the.dimension...species.png"))




```

```{r fig.cap = 'Relatives percentage of catches by species (1) and species group (2) for Fishstat and Nominal catches dataset', eval=FALSE}

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Barplot/Distribution.in.value.for.the.dimension...species.group.gta.png"))

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Barplot/Distribution.in.value.for.the.dimension...species.png"))




```



## 3. Fishing Fleet Variation

Both datasets showed equal counts of fishing fleets but exhibited discrepancies in fleet identities. The GTA dataset lacked data for some countries, but offered aggregated fleet data.


```{r fig.cap = 'Relatives percentage of catches by country for Fishstat and Nominal catches dataset'}

knitr::include_graphics(here("rmd/Comparison_NC_FS/figures_filtered/Barplot/Distribution.in.value.for.the.dimension...fleet.label.png"))

```

The relative importance of countries seems to be close one from another, however the reporting catches of Indonesia are significantly different. 


```{r}
data <- read.csv(here("rmd/Comparison_NC_FS/figures_filtered/Diffstratas/Difference.between.stratas.of.the.two.datasets.csv")) %>% dplyr::select(-measurement_unit) %>% dplyr::rename("Difference in millions" = "Difference..in...") %>% filter(Dimension == "fleet_label")

qflextable2(data, grouped_data = c("Dimension", "Loss...Gain"), columns_to_color  = c("Difference in millions"))
```

For the fishingfleet, NC does not provide data for some countries (with minor impact on the global data) that are `r unique((data %>% dplyr::filter(Loss...Gain == "Loss" & Dimension == "country_label")))$Precision`, however it provides data with aggregated fishingfleet (i.e nei).

## 4. Ocean Basin variation

```{r}

`%notin%` <- Negate(`%in%`)

diffstratas <- read.csv(here("rmd/Comparison_NC_FS/figures_filtered/Diffstratas/Difference.between.stratas.of.the.two.datasets.csv")) %>% dplyr::filter(Dimension %notin% c("year", "GRIDTYPE")) %>% dplyr::select(-measurement_unit) %>% dplyr::rename("Loss / Gain" = "Loss...Gain", "Difference in value" = "Difference.in.value") %>% filter(Dimension == "ocean_basin")

qflextable2(diffstratas, grouped_data = c("Dimension", "Loss / Gain"), columns_to_color = c("Difference in value"))

```

## 5. Major Tuna Variations

For five out of the six major tuna species (Albacore (Thunnus alalunga) **(ALB)**,  Bigeye (Thunnus obesus) **(BET)**, Bluefin (Thunnus thynnus) **(BFT)**, Thunnus orientalis **(PBF)**, Southern bluefin tuna Thunnus maccoyii **(SBF)**, Yellowfin (Thunnus albacares) **(YFT)**), records in the NC dataset surpassed those in Fishstat. 

```{r}
# Major tuna abbreviations and names for titles
major_tunas <- list(
  ALB = "Albacore (Thunnus alalunga)",
  BET = "Bigeye (Thunnus obesus)",
  BFT = "Bluefin (Thunnus thynnus)",
  SBF = "Southern bluefin tuna (Thunnus maccoyii)",
  SKJ = "Skipjack (Katsuwonus pelamis)",
  YFT = "Yellowfin (Thunnus albacares)"
)

# Construct filenames
file_paths <- paste0("outputs/charts/comparison_FS_NC_time_by_species/", names(major_tunas), "_general_comparison_plot.png")

# Function to plot each image with title
plot_image_with_title <- function(file_path) {
  if (file.exists(here(file_path))) {
    img <- knitr::include_graphics(here(file_path))
    img

  }
}
```


```{r}
lapply(file_paths, plot_image_with_title) 
```


However, the Skipjack tuna (Katsuwonus pelamis **(SKJ)**) in Fishstat recorded higher, predominantly due to discrepancies in the Western Central Pacific Ocean.

```{r}

file_paths <- list.files(here("outputs", "charts", "comparison_FS_NC_time_by_species/SKJ_by_ocean"), full.names = TRUE)

lapply(file_paths, plot_image_with_title) 
```


## 7. Conclusion

Both datasets undeniably present invaluable resources for fisheries' analyses. Their discrepancies underline the importance of considering data sources and harmonization methodologies when interpreting results. A more exhaustive analysis is available in the annex.




